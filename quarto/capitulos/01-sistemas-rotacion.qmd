---
title: "1. Sistemas de Rotación"
subtitle: "Modelo combinatorio de grafos encajados"
---

# Sistemas de Rotación

## Motivación

Queremos codificar encajes celulares de grafos en superficies orientables **sin dibujar la superficie**, usando sólo datos combinatorios.

- **Entrada:** un grafo abstracto $G$
- **Dato extra:** un sistema de rotación (orden cíclico local)
- **Salida:** una superficie orientable donde $G$ queda encajado, más las caras y el género

La idea es que la información "local" (en vértices) determine completamente la estructura "global" (la superficie).

---

## Semiaristas (Darts o Half-Edges)

Para trabajar con sistemas de rotación, descomponemos cada arista del grafo $G$ mediante una partición formal. Insertamos un vértice ficticio (o de paso) en el interior de cada arista, lo que resulta en un conjunto $D$ de semiaristas (también llamadas *darts* o *half-edges*).

Esta construcción garantiza que:

- **Partición por Arista:** Cada arista original queda particionada exactamente en dos semiaristas que comparten el vértice ficticio.
- **Incidencia en Vértices Originales:** Cada semiarista $d \in D$ tiene un extremo en un vértice original de $G$ y el otro en un vértice ficticio. Decimos que $d$ está asociada al vértice original donde incide.
- **Relación de Adyacencia (Involución):** Dos semiaristas son adyacentes si comparten el mismo vértice ficticio. Esto define una permutación $\rho: D \to D$ compuesta por trasposiciones (2-ciclos), donde cada ciclo vincula el par de semiaristas que conforman una arista original.

::: {.callout-note}
## Conteo de semiaristas
Si el grafo tiene $E$ aristas, tendremos $|D| = 2E$ semiaristas en total, donde $D$ es el conjunto de todas las semiaristas.
:::

## Ejemplo 1: Un vértice, dos lazos 

Consideremos el grafo con un vértice y dos aristas.

### Construcción

- **Vértices:** 1
- **Aristas:** 2 aristas
- **Semiaristas:** 4 (etiquetadas 1, 2, 3, 4)

![Etiquetado de semiaristas](/imagenes/grafo8base.svg)

---

## Definición: Sistema de Rotación

Un **sistema de rotación** sobre un grafo $G$ se define por un par de permutaciones $(\sigma, \rho)$ sobre el conjunto de semiaristas $D$:

### Permutación $\sigma$ (vértices)

- Es un producto de ciclos disjuntos
- Hay un ciclo por cada vértice de $G$
- Cada ciclo describe el **orden cíclico** de las semiaristas incidentes a ese vértice
- El orden cíclico refleja cómo las aristas se ordenan alrededor del vértice en la superficie

### Permutación $\rho$ (aristas)

- Es un producto de **2-ciclos** (transposiciones)
- Cada 2-ciclo empareja las dos semiaristas que forman una arista
- Es una involución sin puntos fijos: $\rho^2 = \mathrm{id}$

::: {.callout-note}
## Contexto Histórico y Terminología

Los sistemas de rotación tienen una rica historia y han sido redescubiertos en múltiples contextos:

- **Orígenes:** Fueron introducidos por **Edmonds** (1960) y formalizados por **Youngs** (1963), quien también introdujo sistemas con signo para superficies no orientables. Representaciones similares fueron propuestas independientemente por **Jacques**, **Biggs**, y **Walsh & Lehman**.
- **Desarrollo:** **Tutte** y **Gross & Alpert** extendieron estos sistemas. El encaje celular inducido que revisaremos más adelante es frecuentemente llamado *encaje de Heffter-Edmonds*.
- **Sinónimos:** En la literatura se encuentran como *vortex graphs*, *constelaciones*, *mapas combinatorios*, *fat graphs*, *ribbon graphs* y *dessins d'enfants*.

**Nuestra Convención:** Adoptamos la notación de **SageMath** y **Lando & Zvonkin**, usando el par de permutaciones $(\sigma, \rho)$ sobre semiaristas y refiriéndonos a la estructura topológica como **Ribbon Graph**.
:::

---

## Ejemplo: Un vértice, dos lazos

Recordando la construcción del ejemplo anterior:

![](/imagenes/grafo8.svg){width=44%}

- **Vértices:** 1
- **Aristas:** 2 
- **Semiaristas:** 4 (etiquetadas 1, 2, 3, 4)

Es importante notar que $\rho$ está fijo por la construcción del grafo (la elección de qué pares de semiaristas forman cada arista). Por lo tanto, solo podemos variar $\sigma$.

Como tenemos 4 semiaristas incidentes al mismo vértice, el número de posibles órdenes cíclicos es $(4-1)! = 6$. A continuación listamos todas las posibilidades:

1. $\sigma = (1, 2, 3, 4)$, $\rho = (1, 2)(3, 4)$
2. $\sigma = (1, 2, 4, 3)$, $\rho = (1, 2)(3, 4)$
3. $\sigma = (1, 3, 2, 4)$, $\rho = (1, 2)(3, 4)$
4. $\sigma = (1, 3, 4, 2)$, $\rho = (1, 2)(3, 4)$
5. $\sigma = (1, 4, 2, 3)$, $\rho = (1, 2)(3, 4)$
6. $\sigma = (1, 4, 3, 2)$, $\rho = (1, 2)(3, 4)$

Cada una de estas elecciones define un sistema de rotación válido. En las siguientes secciones veremos cómo estas permutaciones determinan la topología de la superficie resultante.

<!--
::: {.callout-tip}
## Equivalencia de sistemas de rotación

Dos sistemas de rotación $(\sigma_1, \rho_1)$ y $(\sigma_2, \rho_2)$ son **equivalentes** (o isomorfos) si existe una reetiquetación de las semiaristas (una permutación $\tau$) tal que:
$$ \sigma_2 = \tau \sigma_1 \tau^{-1} \quad \text{y} \quad \rho_2 = \tau \rho_1 \tau^{-1} $$
En este ejemplo, aunque hay 6 permutaciones distintas para $\sigma$, estas se agrupan en clases de equivalencia que producen la misma superficie (por ejemplo, algunas generan la esfera y otras el toro).
:::

-->

---

## Ejemplo 2: Triángulo K₃

Consideremos el grafo completo con 3 vértices: $K_3$:

![](/imagenes/K3.svg){width=44%}


### Construcción

- **Vértices:** 3 (A, B, C)
- **Aristas:** 3 (AB, BC, CA)
- **Semiaristas:** 6 (etiquetadas 1, 2, 3, 4, 5, 6)

Asignación de semiaristas:

- Vértice A: semiaristas 1, 6
- Vértice B: semiaristas 2, 3
- Vértice C: semiaristas 4, 5

Aristas:

- AB: semiaristas 1 y 2
- BC: semiaristas 3 y 4
- CA: semiaristas 5 y 6

Para definir el sistema de rotación, la asignación explícita de semiaristas es necesaria para fijar $\rho$.

- **$\rho$:** Queda determinado por los pares que forman las aristas.
  $$\rho = (1, 2)(3, 4)(5, 6)$$

- **$\sigma$:** En este caso, como cada vértice tiene grado 2, existe un único orden cíclico posible para las semiaristas incidentes ($(a,b)$ es equivalente a $(b,a)$).
  $$\sigma = (1, 6)(2, 3)(4, 5)$$

Este sistema describe el encaje estándar de $K_3$ en la esfera (género 0).

---

## El "Big Bang" Combinatorio: ¿Cuántos encajes existen?

Para un grafo dado (sin vértices aislados), podemos calcular exactamente cuántos **Sistemas de Rotación** (que generan superficies orientables) se pueden construir. La fórmula depende enteramente de la conectividad local de los vértices.

### La Fórmula de Conteo

Si llamamos $N(G)$ al número total de sistemas de rotación para un grafo $G$, tenemos:

$$ N(G) = \prod_{v \in V(G)} (\deg(v) - 1)! $$

**Donde:**

* **$\prod$**: Es el símbolo de producto (multiplicamos el resultado de cada vértice).
* **$V(G)$**: Es el conjunto de todos los vértices del grafo.
* **$\deg(v)$ (Grado)**: Es el número de semiaristas que llegan al vértice $v$.
* **$(\deg(v) - 1)!$**: Es el número de formas de organizar las semiaristas en un círculo (permutaciones cíclicas).

---

### Verificación de nuestros ejemplos

1. **El grafo de un vértice y dos lazos:**
   * Tenemos 1 vértice con grado $4$.
   * Cálculo: $(4-1)! = 6$ sistemas.
   * *Resultado:* Coincide exactamente con la lista de $6$ que vimos anteriormente.

2. **El Triángulo ($K_3$):**
   * Tenemos 3 vértices, cada uno con grado $2$.
   * Cálculo: $(2-1)! \times (2-1)! \times (2-1)! = 1$ sistema.
   * *Resultado:* Por eso el $K_3$ es "rígido"; solo puede encajarse de una forma (en la esfera).

---

### ¿Cómo crece el problema? (El caso de los Grafos Completos $K_n$)

A medida que añadimos vértices y cada uno se conecta con todos los demás, el número de universos topológicos posibles crece de forma estrepitosa:

| Grafo | Vértices | Grado | Fórmula | Total de Sistemas |
| :---: | :---: | :---: | :---: | :---: |
| **$K_3$** (Triángulo) | 3 | 2 | $(1!)^3$ | **1** |
| **$K_4$** (Tetraedro) | 4 | 3 | $(2!)^4$ | **16** |
| **$K_5$** (Pentáculo) | 5 | 4 | $(3!)^5$ | **7,776** |
| **$K_6$** | 6 | 5 | $(4!)^6$ | **191,102,976** |
| **$K_7$** | 7 | 6 | $(5!)^7$ | **358,318,080,000,000** |

> **Nota para la reflexión:** ¡Para un simple grafo de 7 vértices, existen más de 358 billones de formas de encajarlo en superficies! La gran mayoría de estas formas resultarán en superficies con muchísimos "agujeros" (género alto), y solo unas pocas tendrán género mínimo ($K_7$ no es planar).

---

## Interpretación geométrica

El sistema de rotación $(\sigma, \rho)$ codifica:

1. **El grafo subyacente**
   - Los ciclos de $\sigma$ determinan los vértices
   - Los 2-ciclos de $\rho$ determinan las aristas
   - Podemos reconstruir $G$ desde $(\sigma, \rho)$

2. **El orden cíclico local**
   - Cada ciclo de $\sigma$ indica cómo se ordenan las semiaristas alrededor de un vértice
   - Este orden respeta la orientación de la superficie

---

## Construcción en SageMath

SageMath implementa ribbon graphs directamente desde sistemas de rotación:

Puedes verificar estos cálculos rápidamente en línea usando [SageMathCell](https://sagecell.sagemath.org/).

### Ejemplo 1: Un vértice, dos lazos

Construyamos el sistema de rotación más estándar para este grafo:

```python
# Usamos PermutationGroupElement directamente
sigma = PermutationGroupElement("(1,2,3,4)")
rho = PermutationGroupElement("(1,2)(3,4)")
R = RibbonGraph(sigma, rho)

print(f"Objeto creado: {R}")
print(f"Tipo: {type(R).__name__}")

# Recuperar las permutaciones almacenadas
print(f"\nPermutaciones:")
print(f"  σ = {R.sigma()}")
print(f"  ρ = {R.rho()}")

# Contar elementos del grafo
num_semiaristas = len(R.sigma().domain())
num_vertices = len(R.sigma().cycle_tuples(singletons=True))
num_aristas = len(R.rho().cycle_tuples())

print(f"\nEstructura del grafo:")
print(f"  Semiaristas: {num_semiaristas}")
print(f"  Vértices: {num_vertices}")
print(f"  Aristas: {num_aristas}")
```

### Ejemplo 2: Triángulo K₃ con numeración salteada

Podemos etiquetar las semiaristas con cualquier numeración, no necesariamente 1,2,3,...

```python
# K₃ con numeración consecutiva empezando desde 10
sigma_k3 = PermutationGroupElement("(10,15)(11,12)(13,14)")
rho_k3 = PermutationGroupElement("(10,11)(12,13)(14,15)")
R_k3 = RibbonGraph(sigma_k3, rho_k3)

print(f"K₃ con numeración salteada:")
print(f"  σ = {R_k3.sigma()}")
print(f"  ρ = {R_k3.rho()}")
print(f"  Números usados: 10, 11, 12, 13, 14, 15")

# normalize() renumera del 1 al número de semiaristas
R_norm = R_k3.normalize()

print(f"\nDespués de normalize():")
print(f"  σ = {R_norm.sigma()}")
print(f"  ρ = {R_norm.rho()}")
print(f"  Números usados: 1, 2, 3, 4, 5, 6")

# Verificar que la estructura se preserva
print(f"\nVértices: {len(R_k3.sigma().cycle_tuples())} → {len(R_norm.sigma().cycle_tuples())}")
print(f"Aristas: {len(R_k3.rho().cycle_tuples())} → {len(R_norm.rho().cycle_tuples())}")
```

### Implementando la fórmula de conteo

Podemos calcular programáticamente cuántos sistemas de rotación existen para un grafo dado:

```python
def contar_sistemas(R):
    """
    Calcula N(G) = ∏(deg(v) - 1)! para un RibbonGraph
    """
    grados = [len(ciclo) for ciclo in R.sigma().cycle_tuples(singletons=True)]
    total = 1
    for g in grados:
        total *= factorial(g - 1)
    return total, grados

# Verificar con el Ejemplo 1: Un vértice, dos lazos
sigma1 = PermutationGroupElement("(1,2,3,4)")
rho1 = PermutationGroupElement("(1,2)(3,4)")
R1 = RibbonGraph(sigma1, rho1)

total1, grados1 = contar_sistemas(R1)
print(f"Ejemplo 1: Un vértice, dos lazos")
print(f"  Grados de vértices: {grados1}")
print(f"  N(G) = (4-1)! = {total1}")

# Verificar con el Ejemplo 2: K₃
sigma2 = PermutationGroupElement("(1,6)(2,3)(4,5)")
rho2 = PermutationGroupElement("(1,2)(3,4)(5,6)")
R2 = RibbonGraph(sigma2, rho2)

total2, grados2 = contar_sistemas(R2)
print(f"\nEjemplo 2: Triángulo K₃")
print(f"  Grados de vértices: {grados2}")
print(f"  N(G) = (1!)³ = {total2}")
```

---

## Ejercicios

::: {.callout-tip}
## Ejercicio 1
Considera un grafo con un vértice y tres self-loops (tres aristas que comienzan y terminan en el mismo vértice).

a) ¿Cuántas semiaristas tiene este sistema?
b) ¿Cuántos sistemas de rotación posibles existen para este grafo? Usa la fórmula manualmente.
c) Escribe en Sage un sistema de rotación $(\sigma, \rho)$ para este grafo usando `PermutationGroupElement`.
d) Usa la función `contar_sistemas(R)` del ejemplo para verificar tu cálculo del inciso (b).
:::

::: {.callout-tip}
## Ejercicio 2
Experimentando con numeración y normalización:

a) Crea un `RibbonGraph` usando numeración salteada (por ejemplo, usando solo números pares o múltiplos de 5).
b) Usa el método `.normalize()` para obtener la versión canónica.
c) Verifica que el número de semiaristas se preserva usando `len(R.sigma().domain())`.
d) ¿Qué propiedades del grafo cambian con `normalize()` y cuáles se preservan?
:::

---

## Referencias

- **[GGD2011]** E. Girondo, G. Gonzalez-Diez, *Introduction to Compact Riemann surfaces and Dessins d’enfant*, London Mathematical Society, Student Text 79, 2011.
- **[LZ2004]** S. Lando, A. Zvonkine, *Graphs on Surfaces and Their Applications*, Springer-Verlag, 2004.
- **[Edmonds1960]** J. Edmonds, *A Combinatorial Representation for Polyhedral Surfaces*, Notices Amer. Math. Soc. 7, 1960. (Tesis disponible en [UMD](https://api.drum.lib.umd.edu/server/api/core/bitstreams/31f8e644-51a1-49e0-ae98-aa720eb9bbb2/content))
- **[Youngs1963]** J. W. T. Youngs, *The Genus of a Graph*, Journal of Mathematics and Mechanics, Vol. 12, No. 2, 1963. [JSTOR](https://www.jstor.org/stable/24900867)

::: {.callout-important}
## Cambio de Perspectiva: El Mapa es el Territorio

Hasta ahora, hemos hablado de "poner un grafo sobre una superficie". Sin embargo, en la práctica computacional (y en SageMath), el grafo abstracto y la superficie no existen antes de definir las permutaciones.

Es fundamental entender que el par combinatorio $(\sigma, \rho)$ **ES** el objeto.

No "buscamos" un encaje para un sistema de rotación. El sistema de rotación construye su propia superficie única e inevitable.

En la siguiente sección, veremos cómo estas permutaciones "tejen" la superficie automáticamente, sin necesidad de dibujarla.
:::

::: {style="text-align: center; margin-top: 3em; color: #94a3b8; font-size: 0.9em;"}
Publicado el 06 de febrero de 2026
:::
